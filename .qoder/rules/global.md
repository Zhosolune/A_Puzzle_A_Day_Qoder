---
trigger: always_on
alwaysApply: true
---
# 全局规则

## 核心行为规则
1. 使用中文回答，语气轻松但专业
2. 主动审视需求，指出潜在问题并提供框架外建议
3. 如需求明显不合理，直言指出并给出替代方案（尊重且直接）
4. 操作系统：Windows 11，终端语法：powershell
5. 先阅读项目 README.md；若不存在，将征求你同意后创建
6. 坚持最小可用实现（YAGNI/KISS），仅编写当前所需的最少代码
7. 多文件项目遵循“最小框架”，避免不必要的目录/文件
8. 在需要推翻已有设计而大规模修改/新增代码文件时，应采取“删除-新建”的方式，而不是创建新文件与原文件共存。
9. 禁止向后兼容的方式进行代码重构，应保持定义的一致性和唯一性。

## 代码规范

1. 生成或修改代码文件时添加函数级注释
2. 编写函数式使用标准doc说明函数的参数、功能、返回值（若存在）及参数类型

### Python
1. 方法和类的参数必须包含对应的类型注解
2. 编写Python函数时，遵循以下规则：
  - **格式要求**：使用标准的Python docstring格式（三重引号）
  - **内容要求**：每个函数/方法的文档注释必须包含：
    - 功能描述：简洁明确地说明该函数的作用和目的
    - 参数说明：列出所有输入参数，包括参数名、类型、含义和默认值（如有）
    - 返回值说明：描述返回值的类型和含义
    - 异常说明：列出可能抛出的异常类型和触发条件
3. 注意检查代码质量：
  - **变量类型不匹配**：检查变量赋值时的类型兼容性，特别是Optional类型与非Optional类型之间的赋值
  - **函数返回值类型检查**：验证函数实际返回值与声明的返回类型是否一致
  - **函数参数类型检查**：确保函数调用时传入的参数类型与函数签名匹配
  - **类属性类型检查**：验证类属性的类型注解与实际使用是否一致
  - **版本弃用类型检查**：检查使用了已弃用的Python版本特性，避免在新代码中使用。
  - **类型注释完整性检查**：确保所有函数、方法和类的参数、返回值和属性都有类型注释。

## 输出风格
- 输出简洁直接，优先给出可执行建议
- 合理使用项目符号增强可读性
- 基于事实，避免夸张

## 冲突处理
- 产出前进行冲突检测：同名文件已存在、关键配置（package.json、锁文件）冲突、端口占用
- 发现冲突：默认询问；如选择覆盖，优先备份再覆盖

## 变更记录（operateLog.md）
- 当新功能、多模块改动、数据库结构变更、UI/UX 等重大改动时记录操作，格式：
  - 时间：YYYY-MM-DD HH:mm
  - 操作类型：[新增|修改|删除|重构]
  - 影响文件：完整路径（多文件可列要点）
  - 变更摘要：一句话描述
  - 原因：业务/技术原因
  - 测试状态：[已测试|待测试|无需测试]

